<template>
    <h3 class="text-center mt-4 mb-2">
        [N] = Normal [X] = Exceptional [E] = Elite
    </h3>
    <h3 class="text-center mt-2 mb-4">
        <span class="rarity-text">${totalCount}</span> Base Weapons Found
    </h3>

    <search-area>
        <div class="max-w-11/12 m-auto px-4">
            <div class="flex flex-wrap justify-center items-start">

                <div class="w-full lg:w-auto lg:min-w-70 px-2">
                    <div class="relative mb-2">
                        <select id="category" class="select-base peer" value.bind="selectedDataset"
                                change.trigger="onDatasetChange()" required>
                            <option repeat.for="opt of datasetOptions" value.bind="opt.value">${opt.label}</option>
                        </select>
                        <label for="category" class="floating-label">Category</label>
                    </div>
                </div>

                <div class="w-full lg:w-auto lg:min-w-70 px-2">
                    <div class="relative mb-2">
                        <select id="sockets" class="select-base peer" value.bind="selectedSockets" required>
                            <!-- Empty placeholder must have empty string DOM value for :invalid; numeric options keep model.bind -->
                            <option repeat.for="opt of socketOptions" if.bind="opt.value === ''" value="">${opt.label}</option>
                            <option repeat.for="opt of socketOptions" if.bind="opt.value !== ''" model.bind="opt.value">${opt.label}</option>
                        </select>
                        <label for="sockets" class="floating-label">Sockets</label>
                    </div>
                </div>

                <div class="w-full lg:w-auto lg:min-w-70 px-2">
                    <div class="relative mb-2">
                        <select id="itype" class="select-base peer" value.bind="selectedType" required>
                            <option repeat.for="opt of types"
                                    value.bind="opt.value && opt.value.length ? opt.value[0] : ''">${opt.label}
                            </option>
                        </select>
                        <label for="itype" class="floating-label">Item Type</label>
                    </div>
                </div>

                <div class="w-full lg:w-auto lg:min-w-70 px-2">
                    <div class="relative mb-2">
                        <select id="tier" class="select-base peer" value.bind="selectedTier" required>
                            <option repeat.for="opt of tierOptions" value.bind="opt.value">${opt.label}</option>
                        </select>
                        <label for="tier" class="floating-label">Tier</label>
                    </div>
                </div>

                <div class="w-full lg:w-auto lg:min-w-70 px-2">
                    <div class="relative mb-2">
                        <input id="inputsearch" class="select-base peer" type="text" value.bind="search" required/>
                        <label for="inputsearch" class="floating-label">Filter by Input</label>
                    </div>
                </div>

                <div class="w-full lg:w-auto lg:min-w-35 px-2">
                    <div class="mb-2">
                        <button class="button-base" type="button" click.trigger="resetFilters()">
                            Reset Filters
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </search-area>

    <div class="px-2 mt-5" repeat.for="group of filteredAndGrouped">
        <h4 class="text-xl font-semibold mb-2">${group.typeName}</h4>

        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-2 text-center">
            <template repeat.for="family of group.families">
                <div class="bg-gray-800 rounded-lg shadow p-2" repeat.for="item of family.items">
                    <div class="bg-gray-800 rounded">

                        <div class="mb-1">
                            <div class="text-lg base-text">
                                ${item.Name}
                            </div>
                            <div class="rarity-text"
                                 if.bind="(typeof item.GemSockets === 'number' ? item.GemSockets > 0 : (item.GemSockets && item.GemSockets !== '0'))">
                                <div>(Item Level): Sockets</div>
                                <div>${item.GemSockets}</div>
                            </div>
                        </div>

                        <div class="mb-1">
                            <div class="type-text" if.bind="(item.Type && item.Type.Name) || group.typeName">
                                ${item.Type && item.Type.Name ? item.Type.Name : group.typeName}
                            </div>
                            <div class="type-text" if.bind="item.DamageTypes && item.DamageTypes.length">
                                <div repeat.for="d of item.DamageTypes">
                                    ${getDamageTypeString(d.Type)} ${d.DamageString}
                                </div>
                            </div>
                            <div class="type-text" if.bind="item.Durability && item.Durability > 0">
                                Durability: ${item.Durability}
                            </div>
                        </div>

                        <div class="mb-1">
                            <div class="requirement-text" if.bind="item.RequiredClass && item.RequiredClass.length">
                                (${item.RequiredClass} Only)
                            </div>
                            <div class="requirement-text"
                                 if.bind="item.RequiredDexterity && item.RequiredDexterity > 0">
                                ${item.RequiredDexterity} Dexterity Required
                            </div>
                            <div class="requirement-text" if.bind="item.RequiredStrength && item.RequiredStrength > 0">
                                ${item.RequiredStrength} Strength Required
                            </div>
                            <div class="requirement-text">
                                Level ${item.BaseRequiredLevel > 0 ? item.BaseRequiredLevel : 1} Required
                            </div>
                        </div>

                        <div class="mb-1">
                            <div class=" set-text" if.bind="item.Speed !== null && item.Speed !== undefined">
                                Speed: ${item.Speed}
                            </div>
                            <div class=" set-text" if.bind="item.StrBonus && item.StrBonus > 0">
                                Str Bonus: ${item.StrBonus}%
                            </div>
                            <div class=" set-text" if.bind="item.DexBonus && item.DexBonus > 0">
                                Dex Bonus: ${item.DexBonus}%
                            </div>
                        </div>

                        <div if.bind="item.AutoMagicGroups && item.AutoMagicGroups.length">
                            <div class="flex justify-between items-start mb-1"
                                 repeat.for="group of groupedProperties(item)">
                                <div class="prop-text whitespace-nowrap text-left">
                                    <span if.bind="group.requiredLevel && group.requiredLevel > 0">
                                        Lvl Req ${group.requiredLevel}
                                    </span>
                                </div>
                                <div class="flex flex-col items-end text-right">
                                    <div class="prop-text" repeat.for="line of group.propertyStrings">
                                        ${line}
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </template>
        </div>
    </div>
</template>
